# 实施计划：请购单号字段

## 概述

本实施计划将"请购单号"字段集成到订单管理系统中，涉及数据库模式、类型定义和前端表单的更新。实施将按照从后端到前端的顺序进行，确保每一步都能独立验证。

## 任务

- [x] 1. 更新数据库模式和类型定义
  - [x] 1.1 在 DatabaseManager.ts 的 CREATE TABLE 语句中添加 purchase_order_number 字段
    - 在 `createTables()` 方法中，在 `exw_value` 字段之后添加 `purchase_order_number TEXT`
    - 确保字段位于 `created_at` 之前
    - _需求：1.1, 1.2, 1.3_
  
  - [x] 1.2 更新后端类型定义
    - 在 `backend/src/types/index.ts` 的 Order 接口中添加 `purchaseOrderNumber?: string`
    - 将字段放在 `exwValue` 之后，`createdAt` 之前
    - _需求：2.1, 2.2_
  
  - [ ]* 1.3 编写数据库字段验证测试
    - 验证 orders 表包含 purchase_order_number 字段
    - 验证字段类型为 TEXT
    - 验证字段允许 NULL 值
    - _需求：1.1, 1.2_

- [x] 2. 更新前端类型定义和表单
  - [x] 2.1 更新前端类型定义（如果与后端分离）
    - 检查 `frontend/src/types` 目录是否有独立的类型定义
    - 如果有，添加 `purchaseOrderNumber?: string` 到 Order 接口
    - 如果前端直接使用后端类型，跳过此步骤
    - _需求：2.1, 2.2, 2.3_
  
  - [x] 2.2 在 OrderForm 组件中添加请购单号输入字段
    - 在 `frontend/src/components/OrderForm/OrderForm.tsx` 中添加表单项
    - 位置：在"客户背调"字段之后，"成单产品"字段之前
    - 使用 `<Input>` 组件，标签为"请购单号"
    - 字段名为 `purchaseOrderNumber`
    - 不添加必填验证（可选字段）
    - _需求：3.1, 3.2, 3.3_
  
  - [ ]* 2.3 编写表单字段渲染测试
    - 验证表单包含"请购单号"字段
    - 验证字段没有必填验证
    - 验证字段接受文本输入
    - _需求：3.1, 3.2, 3.3_

- [ ] 3. 实现端到端功能测试
  - [ ]* 3.1 编写属性测试：请购单号往返一致性
    - **属性 1：请购单号往返一致性**
    - **验证：需求 3.4, 3.5, 4.1**
    - 生成随机订单数据和请购单号值
    - 创建订单，保存到数据库，检索订单
    - 验证返回的请购单号与原始值相同
    - 使用 fast-check 库，最少 100 次迭代
  
  - [ ]* 3.2 编写属性测试：请购单号文本处理
    - **属性 2：请购单号文本处理**
    - **验证：需求 1.3, 3.2**
    - 生成各种文本字符串（空字符串、特殊字符、多字节字符）
    - 验证系统能接受、存储并返回相同的值
    - 使用 fast-check 库，最少 100 次迭代
  
  - [ ]* 3.3 编写边缘情况单元测试
    - 测试空值处理：创建不包含请购单号的订单
    - 测试空字符串：创建请购单号为空字符串的订单
    - 测试向后兼容：处理旧数据（没有该字段的订单对象）
    - _需求：4.3, 5.1, 5.2_

- [ ] 4. 检查点 - 验证所有功能
  - 确保所有测试通过
  - 手动测试创建、编辑、保存订单的完整流程
  - 如有问题，请向用户询问

## 注意事项

- 标记为 `*` 的任务是可选的，可以跳过以加快 MVP 开发
- 每个任务都引用了具体的需求编号以便追溯
- 检查点确保增量验证
- 属性测试验证通用正确性属性
- 单元测试验证具体示例和边缘情况
