# 需求文档 - 外贸订单管理系统

## 简介

外贸订单管理系统是一个用于录入和管理外贸订单信息的业务系统。系统以订单为核心，通过公司名关联客户信息，支持订单录入、客户查询、数据统计等功能。

## 术语表

- **系统 (System)**: 外贸订单管理系统
- **用户 (User)**: 使用系统的业务人员
- **订单 (Order)**: 系统中录入的订单记录
- **客户 (Customer)**: 由公司名唯一标识的客户实体
- **公司名 (Company_Name)**: 客户的唯一标识符
- **客户信息 (Contact_Info)**: 订单中的联系人信息（客户名、邮箱、联系方式）
- **客户商机 (Business_Opportunity)**: 与客户（公司名）关联的商机描述

## 需求

### 需求 1: 订单录入管理

**用户故事:** 作为用户，我希望能够录入订单信息，以便记录和跟踪外贸业务。

#### 验收标准

1. 当用户创建新订单时，系统应当验证必填字段（订单日期、公司名、客户信息、线索编号）并保存订单
2. 当用户填写客户信息时，系统应当支持添加多条联系人记录（每条包含客户名、邮箱、联系方式）
3. 当用户输入邮箱时，系统应当验证邮箱格式的有效性
4. 当用户输入数字字段时，系统应当验证发票金额和到款金额为有效数字
5. 当用户保存订单时，系统应当自动记录创建时间和更新时间

### 需求 2: 订单编辑与删除

**用户故事:** 作为用户，我希望能够修改和删除订单，以便维护数据准确性。

#### 验收标准

1. 当用户编辑订单时，系统应当加载现有订单数据并允许修改所有字段
2. 当用户保存修改时，系统应当验证必填字段并更新订单记录
3. 当用户删除订单时，系统应当提示确认并在确认后删除订单记录
4. 当订单被删除时，系统应当保留该订单关联的客户记录（如果该客户还有其他订单）
5. 当订单被删除时，如果该客户没有其他订单，系统应当同时删除客户记录

### 需求 3: 客户信息管理

**用户故事:** 作为用户，我希望系统能够自动管理客户信息，以便通过公司名关联订单。

#### 验收标准

1. 当用户创建订单时，如果公司名不存在，系统应当自动创建新的客户记录
2. 当用户创建订单时，如果公司名已存在，系统应当关联到现有客户记录
3. 当用户更新订单的客户商机字段时，系统应当更新该公司名对应的客户记录
4. 当客户商机被更新时，系统应当使该公司名下所有订单的客户商机保持一致
5. 当用户查询客户时，系统应当按公司名去重显示客户列表

### 需求 4: 订单查询与筛选

**用户故事:** 作为用户，我希望能够通过多种条件查询和筛选订单，以便快速找到需要的数据。

#### 验收标准

1. 当用户查看订单列表时，系统应当显示所有订单并支持分页
2. 当页面初始化时，系统应当自动查询当年数据（默认日期范围：当年1月1日 - 12月31日）
3. 当用户输入公司名称时，系统应当支持模糊搜索并使用防抖处理（500ms延迟）
4. 当用户输入客户名称时，系统应当支持模糊搜索并使用防抖处理（500ms延迟）
5. 当用户选择新老客户时，系统应当支持下拉选择（"新客户"、"老客户"）
6. 当用户选择客户等级时，系统应当支持下拉选择（"A"、"B"、"C"）
7. 当用户输入国家时，系统应当支持模糊搜索并使用防抖处理（500ms延迟）
8. 当用户输入大洲时，系统应当支持模糊搜索并使用防抖处理（500ms延迟）
9. 当用户输入来源时，系统应当支持模糊搜索并使用防抖处理（500ms延迟）
10. 当用户输入客户性质时，系统应当支持模糊搜索并使用防抖处理（500ms延迟）
11. 当用户选择日期范围时，系统应当自动触发查询
12. 当用户点击"搜索"按钮时，系统应当根据所有查询条件执行查询
13. 当用户点击"重置"按钮时，系统应当清空所有查询条件并恢复默认日期范围
14. 当用户点击公司名时，系统应当弹窗显示该公司的所有订单（分页展示）
15. 当查询条件组合使用时，系统应当使用AND逻辑组合所有非空条件

### 需求 5: 客户订单查看

**用户故事:** 作为用户，我希望能够查看某个客户的所有订单，以便了解客户的完整业务历史。

#### 验收标准

1. 当用户点击订单列表中的公司名时，系统应当打开弹窗显示该公司的所有订单
2. 当弹窗显示客户订单时，系统应当支持分页浏览
3. 当弹窗显示客户订单时，系统应当显示该客户的客户商机信息
4. 当用户在弹窗中编辑订单时，系统应当允许直接修改并保存
5. 当用户关闭弹窗时，系统应当刷新订单列表以反映最新数据

### 需求 6: 数据统计与报表

**用户故事:** 作为用户，我希望能够查看订单统计数据，以便分析业务状况。

#### 验收标准

1. 当用户查看订单统计时，系统应当显示订单总数、客户总数（按公司名去重）
2. 当用户查看金额统计时，系统应当显示发票金额总计和到款金额总计
3. 当用户查看客户分布时，系统应当按国家、大洲、客户等级统计订单数量
4. 当用户查看时间趋势时，系统应当按月份统计订单数量和金额趋势
5. 当用户导出报表时，系统应当生成Excel格式的订单明细报表

### 需求 7: 数据持久化

**用户故事:** 作为系统架构师，我希望系统能够可靠地存储和检索数据，以便保证数据安全和业务连续性。

#### 验收标准

1. 当系统执行数据写入操作时，系统应当将数据持久化到SQLite数据库
2. 当系统执行数据查询操作时，系统应当从数据库中检索数据并返回结果
3. 当数据库连接失败时，系统应当返回错误信息并记录日志
4. 当系统执行数据更新操作时，系统应当使用事务确保数据一致性
5. 当系统启动时，系统应当自动创建必要的数据库表结构（如果不存在）

### 需求 8: API接口设计

**用户故事:** 作为前端开发者，我希望后端提供标准的RESTful API，以便前端能够方便地调用业务功能。

#### 验收标准

1. 当前端发送HTTP请求时，系统应当返回标准的JSON格式响应（包含状态码、消息、数据）
2. 当API调用成功时，系统应当返回200状态码和相应的数据
3. 当API调用失败时，系统应当返回适当的错误状态码（400、404、500等）和错误信息
4. 当API接口接收参数时，系统应当验证参数的有效性并返回验证错误信息
5. 当系统处理跨域请求时，系统应当配置适当的CORS策略

### 需求 9: 前端界面交互

**用户故事:** 作为用户，我希望系统界面友好易用，以便快速完成订单录入操作。

#### 验收标准

1. 当用户访问系统时，系统应当显示订单列表和录入入口
2. 当用户填写表单时，系统应当实时验证输入并显示验证错误提示
3. 当用户添加客户信息时，系统应当支持动态添加和删除联系人记录
4. 当用户执行操作时，系统应当显示加载状态指示器
5. 当操作成功或失败时，系统应当显示相应的提示消息

### 需求 10: 查询界面设计

**用户故事:** 作为用户，我希望查询界面提供丰富的筛选条件和良好的交互体验，以便高效地查找订单。

#### 验收标准

1. 当页面加载时，系统应当显示查询表单，包含9个查询条件（日期范围、公司名称、客户名称、新老客户、客户等级、国家、大洲、来源、客户性质）
2. 当用户使用日期范围选择器时，系统应当提供RangePicker组件，默认值为当年1月1日至12月31日
3. 当用户输入文本查询条件时，系统应当提供6个文本输入框（公司名称、客户名称、国家、大洲、来源、客户性质）
4. 当用户选择分类条件时，系统应当提供2个下拉选择器（新老客户：新客户/老客户；客户等级：A/B/C）
5. 当用户在文本输入框中输入时，系统应当应用500ms防抖延迟以优化性能
6. 当用户修改日期范围时，系统应当立即自动触发查询
7. 当用户点击"搜索"按钮时，系统应当根据当前所有查询条件执行查询
8. 当用户点击"重置"按钮时，系统应当清空所有查询条件并将日期范围恢复为默认值（当年1月1日 - 12月31日）
9. 当查询条件为空时，系统应当忽略该条件（不影响查询结果）
10. 当多个查询条件同时存在时，系统应当使用AND逻辑组合所有条件进行查询
