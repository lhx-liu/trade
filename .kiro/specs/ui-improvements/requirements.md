# 需求文档

## 简介

本文档描述了外贸订单管理系统的三个UI改进需求，旨在提升用户体验和操作效率。这些改进包括：在订单录入界面增加客户商机录入功能、优化查询条件的展示方式（实现展开/收起功能）、以及修复统计报表的路由导航问题。

## 术语表

- **Order_Form**: 订单录入表单组件，用于创建和编辑订单信息
- **Query_Form**: 查询条件表单组件，用于筛选订单列表
- **Router**: React Router路由管理器，负责页面导航和URL管理
- **Business_Opportunity**: 客户商机信息，描述客户的潜在业务机会
- **Customer**: 客户实体，包含公司名称和商机信息
- **Statistics_Page**: 统计报表页面，展示订单数据的统计分析

## 需求

### 需求 1: 订单表单中添加客户商机录入

**用户故事:** 作为销售人员，我希望在录入订单时能够直接填写客户商机信息，这样我就不需要切换到客户管理界面单独录入。

#### 验收标准

1. WHEN 用户打开订单录入表单时，THE Order_Form SHALL 显示客户商机输入字段
2. WHEN 用户在订单表单中填写客户商机信息时，THE Order_Form SHALL 接受最多500个字符的文本输入
3. WHEN 用户提交包含客户商机的订单时，THE System SHALL 将商机信息保存到对应的客户记录中
4. WHEN 用户编辑已有订单时，THE Order_Form SHALL 显示该客户的现有商机信息
5. WHEN 同一客户有多个订单时，THE System SHALL 使用最新提交的商机信息更新客户记录

### 需求 2: 查询条件展开/收起功能

**用户故事:** 作为用户，我希望查询界面默认只显示常用的查询条件，并能通过按钮展开更多条件，这样界面更简洁且易于使用。

#### 验收标准

1. WHEN 用户首次加载订单管理页面时，THE Query_Form SHALL 仅显示日期范围和公司名称两个查询字段
2. WHEN 查询条件处于收起状态时，THE Query_Form SHALL 显示"更多条件"按钮
3. WHEN 用户点击"更多条件"按钮时，THE Query_Form SHALL 展开并显示所有隐藏的查询字段（客户名称、新老客户、客户等级、国家、大洲、来源、客户性质）
4. WHEN 查询条件处于展开状态时，THE Query_Form SHALL 将按钮文本更改为"收起条件"
5. WHEN 用户点击"收起条件"按钮时，THE Query_Form SHALL 隐藏额外的查询字段并恢复到默认状态
6. WHEN 查询条件被收起时，THE Query_Form SHALL 保留已填写的隐藏字段值（不清空数据）
7. WHEN 用户在展开状态下填写查询条件并触发搜索时，THE System SHALL 使用所有可见和隐藏字段的值执行查询

### 需求 3: 修复统计报表路由导航

**用户故事:** 作为用户，我希望点击"统计报表"菜单项时能够正确跳转到统计报表页面，这样我就能查看订单的统计数据。

#### 验收标准

1. WHEN 用户点击顶部菜单的"统计报表"项时，THE Router SHALL 将浏览器URL更新为 `/statistics`
2. WHEN 浏览器URL变更为 `/statistics` 时，THE Router SHALL 卸载订单管理页面组件并加载统计报表页面组件
3. WHEN 统计报表页面加载完成时，THE System SHALL 在内容区域显示统计报表界面
4. WHEN 用户点击"订单管理"菜单项时，THE Router SHALL 正确导航回订单管理页面
5. WHEN 用户使用浏览器的前进/后退按钮时，THE Router SHALL 正确切换页面内容与URL保持同步
6. WHEN 页面导航发生时，THE Menu SHALL 高亮显示当前激活的菜单项

### 需求 4: 数据持久化和一致性

**用户故事:** 作为系统管理员，我希望客户商机信息能够正确保存和更新，这样数据始终保持一致和准确。

#### 验收标准

1. WHEN 订单提交包含商机信息时，THE Backend SHALL 在数据库中更新或创建对应客户的商机字段
2. WHEN 客户记录不存在时，THE Backend SHALL 创建新的客户记录并保存商机信息
3. WHEN 客户记录已存在时，THE Backend SHALL 更新现有客户记录的商机字段
4. WHEN 数据库操作失败时，THE Backend SHALL 返回明确的错误信息给前端
5. WHEN 前端接收到错误响应时，THE Order_Form SHALL 显示用户友好的错误提示信息
